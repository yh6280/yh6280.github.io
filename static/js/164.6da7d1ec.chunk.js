"use strict";(self.webpackChunkshiwuguanli=self.webpackChunkshiwuguanli||[]).push([[164],{7164:function(e,n,t){t.r(n),t.d(n,{default:function(){return hn}});var r=t(168),a=t(2791),i=t(9439),l=t(1413),u=t(3394),o=t(177),c=t(286),d=t(1933),m=function(e){var n=(0,c.i)();return(0,d.useQuery)(["users",e],(function(){return n("users",{data:e})}))},s=t(5987),f=t(3734),p=["value","onChange","defaultOptionName","options"],v=function(e){var n=e.value,t=e.onChange,r=e.defaultOptionName,i=e.options,l=(0,s.Z)(e,p);return a.createElement(f.Z,Object.assign({value:null!==i&&void 0!==i&&i.length?E(n):0,onChange:function(e){return null===t||void 0===t?void 0:t(E(e)||void 0)}},l),r?a.createElement(f.Z.Option,{value:0},r):null,null===i||void 0===i?void 0:i.map((function(e){return a.createElement(f.Z.Option,{key:e.id,value:e.id},e.name)})))},E=function(e){return isNaN(Number(e))?0:Number(e)},Z=function(e){var n=m().data;return a.createElement(v,Object.assign({options:n||[]},e))},g=function(e){e.users;var n=e.param,t=e.setParam;return a.createElement(u.Z,{style:{marginBottom:"2rem"},layout:"inline"},a.createElement(u.Z.Item,null,a.createElement(o.Z,{placeholder:"\u9879\u76ee\u540d",type:"text",value:n.name,onChange:function(e){return t((0,l.Z)((0,l.Z)({},n),{},{name:e.target.value}))}})),a.createElement(u.Z.Item,null,a.createElement(Z,{defaultOptionName:"\u8d1f\u8d23\u4eba",value:n.personId,onChange:function(e){return t((0,l.Z)((0,l.Z)({},n),{},{personId:e}))}})))},k=t(7092),h=t(841),y=t(7382),b=t(743),I=t(7892),x=t.n(I),C=t(3504),j=t(7561),w=["checked","onCheckedChange"],O=function(e){var n=e.checked,t=e.onCheckedChange,r=(0,s.Z)(e,w);return a.createElement(j.Z,Object.assign({count:1,value:n?1:0,onChange:function(e){return null===t||void 0===t?void 0:t(!!e)}},r))},T=t(3433),M=t(5861),P=t(7757),N=t.n(P),L=function(e){var n=e.fromId,t=e.type,r=e.referenceId,a=e.list,i=(0,T.Z)(a),l=i.findIndex((function(e){return e.id===n}));if(!r)return A((0,T.Z)(i),l,i.length-1);var u=i.findIndex((function(e){return e.id===r}));return("after"===t?A:F)((0,T.Z)(i),l,u)},F=function(e,n,t){var r=e[t],a=e.splice(n,1)[0],i=e.indexOf(r);return e.splice(i,0,a),e},A=function(e,n,t){var r=e[t],a=e.splice(n,1)[0],i=e.indexOf(r);return e.splice(i+1,0,a),e},D=function(e,n){var t=(0,d.useQueryClient)();return{onSuccess:function(){return t.invalidateQueries(e)},onMutate:function(r){return(0,M.Z)(N().mark((function a(){var i;return N().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return i=t.getQueryData(e),t.setQueryData(e,(function(e){return n(r,e)})),a.abrupt("return",{previousItems:i});case 3:case"end":return a.stop()}}),a)})))()},onError:function(n,r,a){t.setQueryData(e,a.previousItems)}}},S=function(e){return D(e,(function(e,n){return(null===n||void 0===n?void 0:n.filter((function(n){return n.id!==e.id})))||[]}))},Q=function(e){return D(e,(function(e,n){return(null===n||void 0===n?void 0:n.map((function(n){return n.id===e.id?(0,l.Z)((0,l.Z)({},n),e):n})))||[]}))},z=function(e){return D(e,(function(e,n){return n?[].concat((0,T.Z)(n),[e]):[]}))},Y=t(5850),X=function(e){var n=(0,c.i)();return(0,d.useMutation)((function(e){return n("projects/".concat(e.id),{method:"PATCH",data:e})}),Q(e))},R=function(e){var n=(0,c.i)();return(0,d.useMutation)((function(e){return n("projects",{data:e,method:"POST"})}),z(e))},W=function(e){var n=(0,c.i)();return(0,d.useQuery)(["project",{id:e}],(function(){return n("projects/".concat(e))}),{enabled:Boolean(e)})},B=t(5728),H=function(e){var n=(0,C.lr)(),t=(0,i.Z)(n,1)[0],r=K(),l=(0,a.useState)(e),u=(0,i.Z)(l,1)[0];return[(0,a.useMemo)((function(){return(0,Y.P9)(Object.fromEntries(t),u)}),[t,u]),function(e){return r(e)}]},K=function(){var e=(0,C.lr)(),n=(0,i.Z)(e,2),t=n[0],r=n[1];return function(e){var n=(0,Y.sW)((0,l.Z)((0,l.Z)({},Object.fromEntries(t)),e));return r(n)}},U=function(){var e=H(["name","personId"]),n=(0,i.Z)(e,2),t=n[0],r=n[1];return[(0,a.useMemo)((function(){return(0,l.Z)((0,l.Z)({},t),{},{personId:Number(t.personId)||void 0})}),[t]),r]},V=function(){var e=U();return["projects",(0,i.Z)(e,1)[0]]},q=function(){var e=H(["projectCreate"]),n=(0,i.Z)(e,2),t=n[0].projectCreate,r=n[1],a=H(["editingProjectId"]),l=(0,i.Z)(a,2),u=l[0].editingProjectId,o=l[1],c=K(),d=W(Number(u)),m=d.data,s=d.isLoading;return{projectModalOpen:"true"===t||Boolean(u),open:function(){return r({projectCreate:!0})},close:function(){return c({projectCreate:"",editingProjectId:""})},startEdit:function(e){return o({editingProjectId:e})},editingProject:m,isLoading:s}},_=["users"],G=function(e){var n=e.users,t=(0,s.Z)(e,_),r=X(V()).mutate;return a.createElement(k.Z,Object.assign({rowKey:"id",pagination:!1,columns:[{title:a.createElement(O,{checked:!0,disabled:!0}),render:function(e,n){return a.createElement(O,{checked:n.pin,onCheckedChange:(t=n.id,function(e){return r({id:t,pin:e})})});var t}},{title:"\u540d\u79f0",sorter:function(e,n){return e.name.localeCompare(n.name)},render:function(e,n){return a.createElement(C.rU,{to:"projects/".concat(String(n.id))},n.name)}},{title:"\u90e8\u95e8",dataIndex:"organization"},{title:"\u8d1f\u8d23\u4eba",render:function(e,t){var r;return a.createElement("span",null,(null===(r=n.find((function(e){return e.id===t.personId})))||void 0===r?void 0:r.name)||"\u672a\u77e5")}},{title:"\u521b\u5efa\u65f6\u95f4",render:function(e,n){return a.createElement("span",null,n.created?x()(n.created).format("YYYY-MM-DD"):"\u65e0")}},{render:function(e,n){return a.createElement(J,{project:n})}}]},t))},J=function(e){var n,t=e.project,r=q().startEdit,i=function(e){var n=(0,c.i)();return(0,d.useMutation)((function(e){var t=e.id;return n("projects/".concat(t),{method:"DELETE"})}),S(e))}(V()),l=i.mutate;return a.createElement(y.Z,{overlay:a.createElement(b.Z,null,a.createElement(b.Z.Item,{onClick:(n=t.id,function(){return r(n)}),key:"edit"},"\u7f16\u8f91"),a.createElement(b.Z.Item,{onClick:function(){return function(e){h.Z.confirm({title:"\u786e\u5b9a\u5220\u9664\u8fd9\u4e2a\u9879\u76ee\u5417?",content:"\u70b9\u51fb\u786e\u5b9a\u5220\u9664",okText:"\u786e\u5b9a",onOk:function(){l({id:e})}})}(t.id)},key:"delete"},"\u5220\u9664"))},a.createElement(B.zL,{type:"link"},"..."))},$=t(3098),ee=function(){(0,Y.jr)("\u9879\u76ee\u5217\u8868",!1);var e=q().open,n=U(),t=(0,i.Z)(n,2),r=t[0],l=t[1],u=function(e){var n=(0,c.i)();return(0,d.useQuery)(["projects",(0,Y.sW)(e)],(function(){return n("projects",{data:e})}))}((0,Y.Nr)(r,200)),o=u.isLoading,s=u.error,f=u.data,p=m().data;return a.createElement($.Q,{id:"\u9879\u76ee\u5217\u8868"},a.createElement(B.X_,null,a.createElement(B.X2,{marginBottom:2,between:!0},a.createElement("h1",null,"\u9879\u76ee\u5217\u8868"),a.createElement(B.zL,{onClick:e,type:"link"},"\u521b\u5efa\u9879\u76ee")),a.createElement(g,{users:p||[],param:r,setParam:l}),a.createElement(B.Tv,{error:s}),a.createElement(G,{loading:o,users:p||[],dataSource:f||[]})))};ee.whyDidYouRender=!1;var ne=t(9042),te=t(2499),re=t(7309),ae=t(6871),ie=function(e){var n=(0,c.i)(),t=(0,l.Z)((0,l.Z)({},e),{},{name:(0,Y.Nr)(null===e||void 0===e?void 0:e.name,200)});return(0,d.useQuery)(["tasks",t],(function(){return n("tasks",{data:t})}))},le=function(e){var n=(0,c.i)();return(0,d.useMutation)((function(e){return n("tasks/reorder",{data:e,method:"POST"})}),function(e){return D(e,(function(e,n){return L((0,l.Z)({list:n},e)).map((function(n){return n.id===e.fromId?(0,l.Z)((0,l.Z)({},n),{},{kanbanId:e.toKanbanId}):n}))}))}(e))},ue=function(){var e,n=null===(e=(0,ae.TH)().pathname.match(/projects\/(\d+)/))||void 0===e?void 0:e[1];return Number(n)},oe=function(){return W(ue())},ce=function(){return{projectId:ue()}},de=function(){return["kanbans",ce()]},me=function(){var e=H(["name","typeId","processorId","tagId"]),n=(0,i.Z)(e,1)[0],t=ue();return(0,a.useMemo)((function(){return{projectId:t,typeId:Number(n.typeId)||void 0,processorId:Number(n.processorId)||void 0,tagId:Number(n.tagId)||void 0,name:n.name}}),[t,n])},se=function(){return["tasks",me()]},fe=function(){var e=H(["editingTaskId"]),n=(0,i.Z)(e,2),t=n[0].editingTaskId,r=n[1],l=function(e){var n=(0,c.i)();return(0,d.useQuery)(["task",{id:e}],(function(){return n("tasks/".concat(e))}),{enabled:Boolean(e)})}(Number(t)),u=l.data,o=l.isLoading;return{editingTaskId:t,editingTask:u,startEdit:(0,a.useCallback)((function(e){r({editingTaskId:e})}),[r]),close:(0,a.useCallback)((function(){r({editingTaskId:""})}),[r]),isLoading:o}},pe=function(){var e=(0,c.i)();return(0,d.useQuery)(["taskTypes"],(function(){return e("taskTypes")}))};var ve=t.p+"static/media/task.8118694e4adbcfdde6913a3751c4eb04.svg";var Ee,Ze,ge,ke,he,ye,be,Ie,xe,Ce,je,we,Oe,Te=t.p+"static/media/bug.bc7dca9d4a51f551ee6467830220343a.svg",Me=t(3347),Pe=function(e){var n=e.kanbanId,t=(0,a.useState)(""),r=(0,i.Z)(t,2),l=r[0],u=r[1],m=function(e){var n=(0,c.i)();return(0,d.useMutation)((function(e){return n("tasks",{data:e,method:"POST"})}),z(e))}(se()).mutateAsync,s=ue(),f=(0,a.useState)(!1),p=(0,i.Z)(f,2),v=p[0],E=p[1],Z=function(){var e=(0,M.Z)(N().mark((function e(){return N().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m({projectId:s,name:l,kanbanId:n});case 2:E(!1),u("");case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),g=function(){return E((function(e){return!e}))};return(0,a.useEffect)((function(){v||u("")}),[v]),v?a.createElement(Me.Z,null,a.createElement(o.Z,{onBlur:g,placeholder:"\u9700\u8981\u505a\u4e9b\u4ec0\u4e48",autoFocus:!0,onPressEnter:Z,value:l,onChange:function(e){return u(e.target.value)}})):a.createElement("div",{onClick:g},"+\u521b\u5efa\u4e8b\u52a1")},Ne=function(e){var n=e.name,t=e.keyword;if(!t)return a.createElement(a.Fragment,null,n);var r=n.split(t);return a.createElement(a.Fragment,null,r.map((function(e,n){return a.createElement("span",{key:n},e,n===r.length-1?null:a.createElement("span",{style:{color:"#257AFD"}},t))})))},Le=function(e){var n=(0,c.i)();return(0,d.useQuery)(["kanbans",e],(function(){return n("kanbans",{data:e})}))},Fe=function(e){var n=(0,c.i)();return(0,d.useMutation)((function(e){return n("kanbans/reorder",{data:e,method:"POST"})}),function(e){return D(e,(function(e,n){return L((0,l.Z)({list:n},e))}))}(e))},Ae=t(866),De=["children"],Se=["children"],Qe=["children"],ze=function(e){var n=e.children,t=(0,s.Z)(e,De);return a.createElement(Ae.bK,t,(function(e){return a.isValidElement(n)?a.cloneElement(n,(0,l.Z)((0,l.Z)({},e.droppableProps),{},{ref:e.innerRef,provided:e})):a.createElement("div",null)}))},Ye=a.forwardRef((function(e,n){var t,r=e.children,i=(0,s.Z)(e,Se);return a.createElement("div",Object.assign({ref:n},i),r,null===(t=i.provided)||void 0===t?void 0:t.placeholder)})),Xe=function(e){var n=e.children,t=(0,s.Z)(e,Qe);return a.createElement(Ae._l,t,(function(e){return a.isValidElement(n)?a.cloneElement(n,(0,l.Z)((0,l.Z)((0,l.Z)({},e.draggableProps),e.dragHandleProps),{},{ref:e.innerRef})):a.createElement("div",null)}))},Re=["kanban"],We=function(e){var n,t=e.id,r=pe().data,i=null===r||void 0===r||null===(n=r.find((function(e){return e.id===t})))||void 0===n?void 0:n.name;return i?a.createElement("img",{alt:"task-icon",src:"task"===i?ve:Te}):null},Be=function(e){var n=e.task,t=fe().startEdit,r=me().name;return a.createElement(Me.Z,{onClick:function(){return t(n.id)},style:{marginBottom:"0.5rem",cursor:"pointer"},key:n.id},a.createElement("p",null,a.createElement(Ne,{keyword:r,name:n.name})),a.createElement(We,{id:n.typeId}))},He=a.forwardRef((function(e,n){var t=e.kanban,r=(0,s.Z)(e,Re),i=ie(me()).data,l=null===i||void 0===i?void 0:i.filter((function(e){return e.kanbanId===t.id}));return a.createElement(Ue,Object.assign({},r,{ref:n}),a.createElement(B.X2,{between:!0},a.createElement("h3",null,t.name),a.createElement(Ke,{kanban:t,key:t.id})),a.createElement(Ve,null,a.createElement(ze,{type:"ROW",direction:"vertical",droppableId:String(t.id)},a.createElement(Ye,{style:{minHeight:"1rem"}},null===l||void 0===l?void 0:l.map((function(e,n){return a.createElement(Xe,{key:e.id,index:n,draggableId:"task"+e.id},a.createElement("div",null,a.createElement(Be,{key:e.id,task:e})))})))),a.createElement(Pe,{kanbanId:t.id})))})),Ke=function(e){var n=e.kanban,t=function(e){var n=(0,c.i)();return(0,d.useMutation)((function(e){var t=e.id;return n("kanbans/".concat(t),{method:"DELETE"})}),S(e))}(de()).mutateAsync,r=a.createElement(b.Z,null,a.createElement(b.Z.Item,null,a.createElement(re.Z,{type:"link",onClick:function(){h.Z.confirm({okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",title:"\u786e\u5b9a\u5220\u9664\u770b\u677f\u5417",onOk:function(){return t({id:n.id})}})}},"\u5220\u9664")));return a.createElement(y.Z,{overlay:r},a.createElement(re.Z,{type:"link"},"..."))},Ue=te.Z.div(Ee||(Ee=(0,r.Z)(["\n  min-width: 27rem;\n  border-radius: 6px;\n  background-color: rgb(244, 245, 247);\n  display: flex;\n  flex-direction: column;\n  padding: 0.7rem 0.7rem 1rem;\n  margin-right: 1.5rem;\n"]))),Ve=te.Z.div(Ze||(Ze=(0,r.Z)(["\n  overflow: scroll;\n  flex: 1;\n\n  ::-webkit-scrollbar {\n    display: none;\n  }\n"]))),qe=function(e){var n=pe().data;return a.createElement(v,Object.assign({options:n||[]},e))},_e=function(){var e=me(),n=K();return a.createElement(B.X2,{marginBottom:4,gap:!0},a.createElement(o.Z,{style:{width:"20rem"},placeholder:"\u4efb\u52a1\u540d",value:e.name,onChange:function(e){return n({name:e.target.value})}}),a.createElement(Z,{defaultOptionName:"\u7ecf\u529e\u4eba",value:e.processorId,onChange:function(e){return n({processorId:e})}}),a.createElement(qe,{defaultOptionName:"\u7c7b\u578b",value:e.typeId,onChange:function(e){return n({typeId:e})}}),a.createElement(re.Z,{onClick:function(){n({typeId:void 0,processorId:void 0,tagId:void 0,name:void 0})}},"\u6e05\u9664\u7b5b\u9009\u5668"))},Ge=t(7083),Je=function(){var e=(0,a.useState)(""),n=(0,i.Z)(e,2),t=n[0],r=n[1],l=ue(),u=function(e){var n=(0,c.i)();return(0,d.useMutation)((function(e){return n("kanbans",{data:e,method:"POST"})}),z(e))}(de()).mutateAsync,m=function(){var e=(0,M.Z)(N().mark((function e(){return N().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u({name:t,projectId:l});case 2:r("");case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return a.createElement(Ue,null,a.createElement(o.Z,{size:"large",placeholder:"\u65b0\u5efa\u770b\u677f\u540d\u79f0",onPressEnter:m,value:t,onChange:function(e){return r(e.target.value)}}))},$e=function(e){var n=(0,c.i)();return(0,d.useQuery)(["epics",e],(function(){return n("epics",{data:e})}))},en=function(e){var n=$e().data;return a.createElement(v,Object.assign({options:n||[]},e))},nn={labelCol:{span:8},wrapperCol:{span:16}},tn=function(){var e=u.Z.useForm(),n=(0,i.Z)(e,1)[0],t=fe(),r=t.editingTaskId,m=t.editingTask,s=t.close,f=function(e){var n=(0,c.i)();return(0,d.useMutation)((function(e){return n("tasks/".concat(e.id),{method:"PATCH",data:e})}),Q(e))}(se()),p=f.mutateAsync,v=f.isLoading,E=function(e){var n=(0,c.i)();return(0,d.useMutation)((function(e){var t=e.id;return n("tasks/".concat(t),{method:"DELETE"})}),S(e))}(se()).mutate,g=function(){var e=(0,M.Z)(N().mark((function e(){return N().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p((0,l.Z)((0,l.Z)({},m),n.getFieldsValue()));case 2:s();case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,a.useEffect)((function(){n.setFieldsValue(m)}),[n,m]),a.createElement(h.Z,{forceRender:!0,onCancel:function(){s(),n.resetFields()},onOk:g,okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88",confirmLoading:v,title:"\u7f16\u8f91\u4efb\u52a1",visible:!!r},a.createElement(u.Z,Object.assign({},nn,{initialValues:m,form:n}),a.createElement(u.Z.Item,{label:"\u4efb\u52a1\u540d",name:"name",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u4efb\u52a1\u540d"}]},a.createElement(o.Z,null)),a.createElement(u.Z.Item,{label:"\u4efb\u52a1\u7ec4",name:"epicId"},a.createElement(en,{defaultOptionName:"\u4efb\u52a1\u7ec4"})),a.createElement(u.Z.Item,{label:"\u7ecf\u529e\u4eba",name:"processorId"},a.createElement(Z,{defaultOptionName:"\u7ecf\u529e\u4eba"})),a.createElement(u.Z.Item,{label:"\u7c7b\u578b",name:"typeId"},a.createElement(qe,null))),a.createElement("div",{style:{textAlign:"right"}},a.createElement(re.Z,{onClick:function(){s(),h.Z.confirm({okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",title:"\u786e\u5b9a\u5220\u9664\u4efb\u52a1\u5417",onOk:function(){return E({id:Number(r)})}})},style:{fontSize:"14px"},size:"small"},"\u5220\u9664")))},rn=function(){(0,Y.jr)("\u770b\u677f\u5217\u8868");var e=oe().data,n=Le(ce()),t=n.data,r=n.isLoading,i=ie(me()).isLoading||r,l=an();return a.createElement($.Q,{id:"\u770b\u677f\u9875\u9762"},a.createElement(Ae.Z5,{onDragEnd:l},a.createElement(B.X_,null,a.createElement("h1",null,null===e||void 0===e?void 0:e.name,"\u770b\u677f"),a.createElement(_e,null),i?a.createElement(Ge.Z,{size:"large"}):a.createElement(ln,null,a.createElement(ze,{type:"COLUMN",direction:"horizontal",droppableId:"kanban"},a.createElement(Ye,{style:{display:"flex"}},null===t||void 0===t?void 0:t.map((function(e,n){return a.createElement(Xe,{key:e.id,draggableId:"kanban"+e.id,index:n},a.createElement(He,{kanban:e,key:e.id}))})))),a.createElement(Je,null)),a.createElement(tn,null))))},an=function(){var e=Le(ce()).data,n=Fe(de()).mutate,t=le(se()).mutate,r=ie(me()).data,i=void 0===r?[]:r;return(0,a.useCallback)((function(r){var a=r.source,l=r.destination,u=r.type;if(l){if("COLUMN"===u){var o=null===e||void 0===e?void 0:e[a.index].id,c=null===e||void 0===e?void 0:e[l.index].id;if(!o||!c||o===c)return;var d=l.index>a.index?"after":"before";n({fromId:o,referenceId:c,type:d})}if("ROW"===u){var m=+a.droppableId,s=+l.droppableId,f=i.filter((function(e){return e.kanbanId===m}))[a.index],p=i.filter((function(e){return e.kanbanId===s}))[l.index];if((null===f||void 0===f?void 0:f.id)===(null===p||void 0===p?void 0:p.id))return;t({fromId:null===f||void 0===f?void 0:f.id,referenceId:null===p||void 0===p?void 0:p.id,fromKanbanId:m,toKanbanId:s,type:m===s&&l.index>a.index?"after":"before"})}}}),[e,n,i,t])},ln=(0,te.Z)("div")(ge||(ge=(0,r.Z)(["\n  display: flex;\n  overflow-x: scroll;\n  flex: 1;\n"]))),un=t(2126),on=function(){return{projectId:ue()}},cn=function(){return["epics",on()]},dn=t(8894),mn=function(e){var n=function(e){var n=(0,c.i)();return(0,d.useMutation)((function(e){return n("epics",{data:e,method:"POST"})}),z(e))}(cn()),t=n.mutate,r=n.isLoading,m=n.error,s=u.Z.useForm(),f=(0,i.Z)(s,1)[0],p=ue(),v=function(){var n=(0,M.Z)(N().mark((function n(r){return N().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t((0,l.Z)((0,l.Z)({},r),{},{projectId:p}));case 2:e.onClose();case 3:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();return(0,a.useEffect)((function(){f.resetFields()}),[f,e.visible]),a.createElement(dn.Z,{visible:e.visible,onClose:e.onClose,forceRender:!0,destroyOnClose:!0,width:"100%"},a.createElement(sn,null,r?a.createElement(Ge.Z,{size:"large"}):a.createElement(a.Fragment,null,a.createElement("h1",null,"\u521b\u5efa\u4efb\u52a1\u7ec4"),a.createElement(B.Tv,{error:m}),a.createElement(u.Z,{form:f,layout:"vertical",style:{width:"40rem"},onFinish:v},a.createElement(u.Z.Item,{label:"\u540d\u79f0",name:"name",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u4efb\u52a1\u7ec4\u540d"}]},a.createElement(o.Z,{placeholder:"\u8bf7\u8f93\u5165\u4efb\u52a1\u7ec4\u540d\u79f0"})),a.createElement(u.Z.Item,{style:{textAlign:"right"}},a.createElement(re.Z,{loading:r,type:"primary",htmlType:"submit"},"\u63d0\u4ea4"))))))},sn=te.Z.div(ke||(ke=(0,r.Z)(["\n  height: 80vh;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n"]))),fn=function(){var e=oe().data,n=$e(on()).data,t=ie({projectId:null===e||void 0===e?void 0:e.id}).data,r=function(e){var n=(0,c.i)();return(0,d.useMutation)((function(e){var t=e.id;return n("epics/".concat(t),{method:"DELETE"})}),S(e))}(cn()).mutate,l=(0,a.useState)(!1),u=(0,i.Z)(l,2),o=u[0],m=u[1];return a.createElement(B.X_,null,a.createElement(B.X2,{between:!0},a.createElement("h1",null,null===e||void 0===e?void 0:e.name,"\u4efb\u52a1\u7ec4"),a.createElement(re.Z,{onClick:function(){return m(!0)},type:"link"},"\u521b\u5efa\u4efb\u52a1\u7ec4")),a.createElement(un.ZP,{style:{overflow:"scroll"},dataSource:n,itemLayout:"vertical",renderItem:function(n){return a.createElement(un.ZP.Item,null,a.createElement(un.ZP.Item.Meta,{title:a.createElement(B.X2,{between:!0},a.createElement("span",null,n.name),a.createElement(re.Z,{onClick:function(){return function(e){h.Z.confirm({title:"\u786e\u5b9a\u5220\u9664\u9879\u76ee\u7ec4\uff1a".concat(e.name),content:"\u70b9\u51fb\u786e\u5b9a\u5220\u9664",okText:"\u786e\u5b9a",onOk:function(){r({id:e.id})}})}(n)},type:"link"},"\u5220\u9664")),description:a.createElement("div",null,a.createElement("div",null,"\u5f00\u59cb\u65f6\u95f4\uff1a",x()(n.start).format("YYYY-MM-DD")),a.createElement("div",null,"\u7ed3\u675f\u65f6\u95f4\uff1a",x()(n.end).format("YYYY-MM-DD")))}),a.createElement("div",null,null===t||void 0===t?void 0:t.filter((function(e){return e.epicId===n.id})).map((function(n){return a.createElement(C.rU,{to:"/projects/".concat(null===e||void 0===e?void 0:e.id,"/kanban?editingTaskId=").concat(n.id),key:n.id},n.name)}))))}}),a.createElement(mn,{onClose:function(){return m(!1)},visible:o}))},pn=function(){var e=function(){var e=(0,ae.TH)().pathname.split("/");return e[e.length-1]}();return a.createElement(Zn,null,a.createElement(vn,null,a.createElement(b.Z,{mode:"inline",selectedKeys:[e]},a.createElement(b.Z.Item,{key:"kanban"},a.createElement(C.rU,{to:"kanban"},"\u770b\u677f")),a.createElement(b.Z.Item,{key:"epic"},a.createElement(C.rU,{to:"epic"},"\u4efb\u52a1\u7ec4")))),a.createElement(En,null,a.createElement(ae.Z5,null,a.createElement(ae.AW,{path:"kanban",element:a.createElement(rn,null)}),a.createElement(ae.AW,{path:"epic",element:a.createElement(fn,null)}),a.createElement(ae.AW,{index:!0,element:a.createElement(rn,null)}))))},vn=te.Z.aside(he||(he=(0,r.Z)(["\n  background-color: rgb(244, 245, 247);\n  display: flex;\n"]))),En=te.Z.div(ye||(ye=(0,r.Z)(["\n  box-shadow: -5px 0 5px -5px rgba(0, 0, 0, 0.1);\n  display: flex;\n  overflow: hidden;\n"]))),Zn=te.Z.div(be||(be=(0,r.Z)(["\n  display: grid;\n  grid-template-columns: 16rem 1fr;\n  width: 100%;\n"]))),gn=function(){var e=q(),n=e.projectModalOpen,t=e.close,r=e.editingProject,c=e.isLoading,d=(r?X:R)(V()),m=d.mutateAsync,s=d.error,f=d.isLoading,p=u.Z.useForm(),v=(0,i.Z)(p,1)[0],E=r?"\u7f16\u8f91\u9879\u76ee":"\u521b\u5efa\u9879\u76ee";return(0,a.useEffect)((function(){v.setFieldsValue(r)}),[r,v]),a.createElement(dn.Z,{forceRender:!0,onClose:function(){v.resetFields(),t()},visible:n,width:"100%"},a.createElement(kn,null,c?a.createElement(Ge.Z,{size:"large"}):a.createElement(a.Fragment,null,a.createElement("h1",null,E),a.createElement(B.Tv,{error:s}),a.createElement(u.Z,{form:v,layout:"vertical",style:{width:"40rem"},onFinish:function(e){m((0,l.Z)((0,l.Z)({},r),e)).then((function(){v.resetFields(),t()}))}},a.createElement(u.Z.Item,{label:"\u540d\u79f0",name:"name",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u9879\u76ee\u540d"}]},a.createElement(o.Z,{placeholder:"\u8bf7\u8f93\u5165\u9879\u76ee\u540d\u79f0"})),a.createElement(u.Z.Item,{label:"\u90e8\u95e8",name:"organization",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u90e8\u95e8\u540d"}]},a.createElement(o.Z,{placeholder:"\u8bf7\u8f93\u5165\u90e8\u95e8\u540d"})),a.createElement(u.Z.Item,{label:"\u8d1f\u8d23\u4eba",name:"personId"},a.createElement(Z,{defaultOptionName:"\u8d1f\u8d23\u4eba"})),a.createElement(u.Z.Item,{style:{textAlign:"right"}},a.createElement(re.Z,{loading:f,type:"primary",htmlType:"submit"},"\u63d0\u4ea4"))))))},kn=te.Z.div(Ie||(Ie=(0,r.Z)(["\n  height: 80vh;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n"])));function hn(){return a.createElement(In,null,a.createElement(yn,null),a.createElement(wn,null,a.createElement(ae.Z5,null,a.createElement(ae.AW,{path:"projects",element:a.createElement(ee,null)}),a.createElement(ae.AW,{path:"projects/:projectId/*",element:a.createElement(pn,null)}),a.createElement(ae.AW,{index:!0,element:a.createElement(ee,null)}))),a.createElement(gn,null))}var yn=function(){return a.createElement(xn,{between:!0},a.createElement(Cn,{gap:!0},a.createElement(B.zL,{type:"link",onClick:Y.Xj},"\u9996\u9875")),a.createElement(jn,null,a.createElement(bn,null)))},bn=function(){var e=(0,ne.a)(),n=e.logout,t=e.user;return a.createElement(y.Z,{overlay:a.createElement(b.Z,null,a.createElement(b.Z.Item,{key:"logout"},a.createElement(re.Z,{onClick:n,type:"link"},"\u767b\u51fa")))},a.createElement(re.Z,{type:"link",onClick:function(e){return e.preventDefault()}},"Hi, ",null===t||void 0===t?void 0:t.name))},In=te.Z.div(xe||(xe=(0,r.Z)(["\n  display: grid;\n  grid-template-rows: 6rem 1fr;\n  height: 100vh;\n"]))),xn=(0,te.Z)(B.X2)(Ce||(Ce=(0,r.Z)(["\n  padding: 3.2rem;\n  box-shadow: 0 0 5px 0 rgba(0, 0, 0, 0.1);\n  z-index: 1;\n"]))),Cn=(0,te.Z)(B.X2)(je||(je=(0,r.Z)([""]))),jn=te.Z.div(we||(we=(0,r.Z)([""]))),wn=te.Z.main(Oe||(Oe=(0,r.Z)(["\n  display: flex;\n  overflow: hidden;\n"])))}}]);
//# sourceMappingURL=164.6da7d1ec.chunk.js.map